---
title: TCP与
date: 2019-05-28 11:15:23
categories: 面试
---

网络编程是在两个或两个以上的设备（例如计算机）之间传输数据。

网络通信协议有很多种，目前最广泛的是`TCP/IP`和`UDP`协议。

`UDP`是无连接通信协议，即在数据传输时，数据的发送端和接受端不建立逻辑连接。简单来说，当一台计算机向另一台计算机发送数据时，发送端不会确认接受端是否存在，就发送数据，同样接受端收到数据时，也不会向发送端反馈是否收到数据。

由于使用`UDP`协议消耗资源小，通信效率高，所以通常都会应用于音频、视频和普通数据的传输。例如视频会议都使用`UDP`协议，因为这种情况即使丢失一两个数据包，也不会对接受的结果产生太大的影响。

但是在使用`UDP`协议传送数据时，由于`UDP`的面向无连接性，不能保证数据的完整性，因此在传输重要数据时不建议使用`UDP`协议。`UDP`交换过程如下所示：

![UDP交换过程](E:\文档\知识点\images\UDP交互过程.png)


`TCP`协议是面向连接的通信协议，即传输数据前先在发送端与接收端建立逻辑连接，然后在传输数据，它提供了两台计算之间可靠无差错的数据传输。在`TCP`连接中必须要明确客户端与服务器端，由客户端向服务器端发出连接请求，每次连接的创建都需要经过“三次握手”，第一次握手，客户端向服务器端发出连接请求，等待服务器确认，第二次握手，服务器向客户端回送一个响应，通知客户端收到了连接请求，第三次握手，客户端再次向服务器端发送确认信息，确认连接。

由于`TCP`协议的面向连接特性，它可以保证传输数据的安全性，所以是一个被广泛采用的协议。例如在下载文件时，如果数据接受不完整，将会导致文件数据丢失而不能被打开，因此，下载文件时必须采用`TCP`协议。整个交互过程如下：

![TCP三次握手过程](E:\文档\知识点\images\TCP三次握手.png)







##### 为什么建立连接是三次握手，关闭连接确是四次挥手？

建立连接时，服务器处于LISTEN状态下，收到建立连接请求的`SYN`报文后，把`ACK`和`SYN`放在一个报文里发送给客户端。而关闭连接时，服务器收到对方的`FIN`报文时，仅仅表示对方不再发送数据了，但是还能接受数据，而自己也未必将全部数据都发送给了对方，所以己方可以立即关闭，也可以发送一些数据给对方后，在发送FIN报给对方来表示同意现在关闭连接，因此，己方的`ACK`和`FIN`一般都会分开发送，从而导致多一次。

##### 如果已经建立了连接，但是客户端突然出现故障了怎么办？

`TCP`设有一个保活计时器，显然，客户端如果出现故障，服务器不能一直等下去，白白浪费资源。服务器每收到一次客户端的请求都会重新复位这个计时器，时间通常设置为2小时，若两个小时还没有收到客户端的任何数据，服务器就会发送一个探测报文段，以后每隔75分钟发一次，若一连发送10个探测报文仍然没反应，服务器就认为客户端出了故障，接着就关闭连接。